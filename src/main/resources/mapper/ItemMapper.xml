<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcomputerstudy.example.mapper.ItemMapper">
	<select id="getItemList" resultType ="Item">
		SELECT 		*
		FROM 		Item
		
	</select>
	
	<select id="getMidleList" resultType="MidleItem">
		SELECT	*
		FROM	midleitem
	</select>
	
	<select id="getProductList" resultType="Product">
		SELECT		*
		FROM		product ta
		LEFT JOIN 	midleitem tb ON ta.m_idx = tb.m_idx
		LEFT JOIN 	item tc ON ta.i_idx = tc.i_idx
	</select>
	
	
	
	<select id="itemsetDetail" resultType ="Item">
		SELECT	*
		FROM	item
		WHERE	i_idx=#{i_idx}
	</select>
	
	<select id="midlesetDetail" resultType="MidleItem">
		SELECT	*
		FROM	midleitem
		WHERE	m_idx=#{m_idx}
	</select>
	
	
	<select id="productsetDetail" resultType="Product">
		SELECT		*
		FROM		product ta
		LEFT JOIN 	item tb ON ta.i_idx=tb.i_idx
		LEFT join 	midleitem tc ON ta.m_idx=tc.m_idx
		
		WHERE		ta.p_idx = #{p_idx}
	</select>
	
	<select id="productsetfileUpdate" resultType="Product">
		SELECT	*
		FROM	file
		WHERE	p_idx= #{p_idx}
	</select>
	
	<resultMap id="productResult" type="Product">
		<id property="p_idx"			column="p_idx"/>
		<result property="p_name"		column="p_name"/>
		<result property="p_content"		column="p_content"/>
		<result property="p_date"	column="p_date"/>
		<result property="p_price" column="p_price"/>
		
		<collection property="comments" ofType="Comment">
			<id property="c_no"			column="c_no"/>
			<result property="i_idx"			column="i_idx"/>
			<result property="c_content"	column="c_content"/>
			<result property="c_writer"		column="c_writer"/>
			<result property="c_date"		column="c_date"/>
		</collection>
		 
		<collection property="boardFiles" ofType="BoardFile">
			<id property="bfIdx"			column="bf_idx"/>
			<result property="i_idx"			column="i_idx"/>
			<result property="fileName"		column="fileName"/>
		</collection>
		
	</resultMap>
	
	<select id="productdetail" resultMap="productResult">
		SELECT		*
		FROM		product ta
		LEFT JOIN 	comment tb ON ta.p_idx = tb.p_idx
		LEFT JOIN	file tc ON ta.p_idx = tc.p_idx
		WHERE		ta.p_idx = #{p_idx}
	</select>
	
	<insert id="itemInsert" parameterType="Item">
		INSERT INTO item(
			i_idx,
			i_name
		)VALUES(
			#{i_idx},
			#{i_name}
		)
		
	</insert>
	<insert id="midleitemInsert" parameterType="MidleItem">
		INSERT INTO midleitem(
			i_idx,
			m_idx,
			m_name
		)VALUES(
			#{i_idx},
			#{m_idx},
			#{m_name}
		)
		
	</insert>

	<insert id="productInsert" parameterType="Product">
		INSERT INTO product(
			i_idx,
			m_idx,
			p_idx,
			p_name,
			p_content,
			p_date,
			p_price
		)VALUES(
			#{i_idx},
			#{m_idx},
			#{p_idx},
			#{p_name},
			#{p_content},
			#{p_date},
			#{p_price}
		)
	</insert>
	

	<insert id="fileNames" parameterType="Product">	
		INSERT INTO file(p_idx, fileName)
		VALUES
		<foreach item="item" collection="fileNames" separator= ",">
			(#{p_idx},#{item})
		</foreach>
		
	</insert>
	<insert id="itemsetUpdate" parameterType="Item">
		UPDATE Item
		SET
			i_name =#{i_name}
			
		WHERE i_idx = #{i_idx}
	</insert>
	
	<insert id="itemsetDelete" parameterType="Item">
		DELETE 
		FROM Item
		WHERE i_idx = #{i_idx}
		
	</insert>
	<insert id="midlesetUpdate" parameterType="MidleItem">
		UPDATE midleitem
		SET
			
			m_name = #{m_name}
		WHERE m_idx=#{m_idx}
	</insert>
	<insert id ="midlesetDelete" parameterType="MidleItem">
		DELETE
		FROM midleitem
		WHERE m_idx = #{m_idx}
	</insert>
	
	<insert id="productsetUpdate" parameterType="Product">
		UPDATE product
		SET
			p_name = #{p_name},
			p_content = #{p_content},
			p_date = #{p_date},
			p_price =#{p_price}
			
		WHERE p_idx=#{p_idx}
	</insert>
	
	<insert id="productfileDelete" parameterType="BoardFile">
		DELETE 
		FROM file
		WHERE bf_idx = #{bfIdx}
	</insert>
	
	<insert id ="productsetDelete" parameterType="Product">
		DELETE ta.*, tb.*
		FROM product ta 
		LEFT JOIN file tb ON ta.p_idx = tb.p_idx
		WHERE ta.p_idx = #{p_idx}
	</insert>





</mapper>